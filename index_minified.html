<!DOCTYPE html>
<html lang="ru">
<head>
	<title>js</title>
</head>
 <style>
   body { 
    margin: 0;
   }
</style>
<body bgcolor="222222">
	<canvas id='ex' ></canvas>

	<script type="text/javascript">	function Tile(e,t){this.isEmpty=e;this.color=t}function Point(e,t){this.raw=e;this.col=t}function GLeftBlock(){color="Orange";gridCell=blockStartPos;raw=0;col=blockStartPos;currentRotateState=0;points=new Array(new Point(0,blockStartPos-1),new Point(0,blockStartPos),new Point(1,blockStartPos),new Point(2,blockStartPos));RStates=new Array(new Array(new Point(-2,0),new Point(-1,1),new Point(0,0),new Point(1,-1)),new Array(new Point(0,2),new Point(1,1),new Point(0,0),new Point(-1,-1)),new Array(new Point(2,0),new Point(1,-1),new Point(0,0),new Point(-1,1)),new Array(new Point(0,-2),new Point(-1,-1),new Point(0,0),new Point(1,1)));for(var e=0;e<4;e++)if(false==grid[points[e].raw][points[e].col].isEmpty)LOSS=true;this.draw()}function GRightBlock(){color="OrangeRed";gridCell=blockStartPos;raw=0;col=blockStartPos;currentRotateState=0;points=new Array(new Point(0,blockStartPos),new Point(0,blockStartPos+1),new Point(1,blockStartPos),new Point(2,blockStartPos));RStates=new Array(new Array(new Point(-1,1),new Point(0,2),new Point(0,0),new Point(1,-1)),new Array(new Point(1,1),new Point(2,0),new Point(0,0),new Point(-1,-1)),new Array(new Point(1,-1),new Point(0,-2),new Point(0,0),new Point(-1,1)),new Array(new Point(-1,-1),new Point(-2,0),new Point(0,0),new Point(1,1)));for(var e=0;e<4;e++)if(false==grid[points[e].raw][points[e].col].isEmpty)LOSS=true;this.draw()}function LineBlock(){color="Gold";gridCell=blockStartPos;raw=0;col=blockStartPos;currentRotateState=0;points=new Array(new Point(0,blockStartPos),new Point(1,blockStartPos),new Point(2,blockStartPos),new Point(3,blockStartPos));RStates=new Array(new Array(new Point(0,1),new Point(1,0),new Point(2,-1),new Point(3,-2)),new Array(new Point(0,-1),new Point(-1,0),new Point(-2,1),new Point(-3,2)));for(var e=0;e<4;e++)if(false==grid[points[e].raw][points[e].col].isEmpty)LOSS=true;this.draw()}function SquareBlock(){color="Cyan";gridCell=blockStartPos;raw=0;col=blockStartPos;points=new Array(new Point(0,blockStartPos),new Point(0,blockStartPos+1),new Point(1,blockStartPos),new Point(1,blockStartPos+1));for(var e=0;e<4;e++)if(false==grid[points[e].raw][points[e].col].isEmpty)LOSS=true;this.draw()}function StairBlock(){color="Magenta";gridCell=blockStartPos;raw=0;col=blockStartPos;currentRotateState=0;points=new Array(new Point(0,blockStartPos),new Point(1,blockStartPos-1),new Point(1,blockStartPos),new Point(1,blockStartPos+1));RStates=new Array(new Array(new Point(-1,1),new Point(-1,-1),new Point(0,0),new Point(1,1)),new Array(new Point(1,1),new Point(-1,1),new Point(0,0),new Point(1,-1)),new Array(new Point(1,-1),new Point(1,1),new Point(0,0),new Point(-1,-1)),new Array(new Point(-1,-1),new Point(1,-1),new Point(0,0),new Point(-1,1)));for(var e=0;e<4;e++)if(false==grid[points[e].raw][points[e].col].isEmpty)LOSS=true;this.draw()}function ZRightBlock(){color="Lime";gridCell=blockStartPos;raw=0;col=blockStartPos;currentRotateState=0;points=new Array(new Point(0,blockStartPos),new Point(0,blockStartPos+1),new Point(1,blockStartPos),new Point(1,blockStartPos-1));RStates=new Array(new Array(new Point(-1,1),new Point(0,2),new Point(0,0),new Point(-1,-1)),new Array(new Point(1,1),new Point(2,0),new Point(0,0),new Point(-1,1)),new Array(new Point(1,-1),new Point(0,-2),new Point(0,0),new Point(1,1)),new Array(new Point(-1,-1),new Point(-2,0),new Point(0,0),new Point(1,-1)));for(var e=0;e<4;e++)if(false==grid[points[e].raw][points[e].col].isEmpty)LOSS=true;this.draw()}function ZLeftBlock(){color="Chartreuse";gridCell=blockStartPos;raw=0;col=blockStartPos;currentRotateState=0;points=new Array(new Point(0,blockStartPos),new Point(0,blockStartPos+1),new Point(1,blockStartPos+1),new Point(1,blockStartPos+2));RStates=new Array(new Array(new Point(-2,0),new Point(-1,1),new Point(0,0),new Point(1,1)),new Array(new Point(0,2),new Point(1,1),new Point(0,0),new Point(1,-1)),new Array(new Point(2,0),new Point(1,-1),new Point(0,0),new Point(-1,-1)),new Array(new Point(0,-2),new Point(-1,-1),new Point(0,0),new Point(-1,1)));for(var e=0;e<4;e++)if(false==grid[points[e].raw][points[e].col].isEmpty)LOSS=true;this.draw()}function drawGrid(){var e=canvasW/2-gridSizeX/2*blockSizeX+blockSizeX;var t=startY;for(var n=0;n<gridSizeY;n++){for(var r=1;r<gridSizeX+1;r++){ctx.fillStyle="Chartreuse";ctx.clearRect(e+(r-1)*blockSizeX,startY+n*blockSizeY,blockSizeX,blockSizeY);ctx.fillStyle=grid[n][r].color;ctx.fillRect(e+(r-1)*blockSizeX,startY+n*blockSizeY,blockSizeX,blockSizeY);if(false==grid[n][r].isEmpty){ctx.strokeStyle="backgroundColor";ctx.beginPath();ctx.moveTo(e+(r-1)*blockSizeX-1,startY+n*blockSizeY);ctx.lineTo(e+(r-1)*blockSizeX+blockSizeX-1,startY+n*blockSizeY);ctx.lineTo(e+(r-1)*blockSizeX+blockSizeX-1,startY+n*blockSizeY+blockSizeY);ctx.lineTo(e+(r-1)*blockSizeX,startY+n*blockSizeY+blockSizeY);ctx.lineTo(e+(r-1)*blockSizeX,startY+n*blockSizeY);ctx.stroke()}}}drawScore()}function drawScore(){ctx.clearRect(dx+gridSizeX*blockSizeX+100,startY+gridSizeY/2*blockSizeY-100,200,150);ctx.fillStyle=backgroundColor;ctx.fillRect(dx+gridSizeX*blockSizeX+100,startY+gridSizeY/2*blockSizeY-100,200,150);ctx.font="40px Verdana";var e=ctx.createLinearGradient(0,0,canvasW,canvasH);e.addColorStop("0","magenta");e.addColorStop("0.5","blue");e.addColorStop("1.0","red");ctx.fillStyle=e;ctx.fillText("SCORE:",dx+gridSizeX*blockSizeX+100,startY+gridSizeY/2*blockSizeY-50);ctx.fillText(SCORE,dx+gridSizeX*blockSizeX+100,startY+gridSizeY/2*blockSizeY+5)}function drawBorder(){var e=canvasW/2-gridSizeX/2*blockSizeX+blockSizeX;var t=startY;ctx.fillStyle=backgroundColor;ctx.fillRect(0,0,canvasW,canvasH);ctx.strokeStyle=borderColor;ctx.lineWidth=borderThickness;ctx.beginPath();ctx.moveTo(e-borderThickness/2,startY);ctx.lineTo(e-borderThickness/2,gridSizeY*blockSizeY+borderThickness/2+startY);ctx.lineTo(e+gridSizeX*blockSizeX+borderThickness/2,gridSizeY*blockSizeY+borderThickness/2+startY);ctx.lineTo(e+gridSizeX*blockSizeX+borderThickness/2,startY);ctx.stroke()}function initGrid(){grid=new Array(gridSizeY+1);for(var e=0;e<gridSizeY+1;e++)grid[e]=new Array(gridSizeX+2);for(var e=0;e<gridSizeY+1;e++)for(var t=0;t<gridSizeX+2;t++){var n=true;if(0==t|gridSizeX+1==t)n=false;grid[e][t]=new Tile(n,backgroundColor);if(gridSizeY==e)grid[e][t].isEmpty=false}}function createNewBlock(){blockNum=(Math.random()*(NUMBER_OF_BLOCKS-1)).toFixed();if(0==blockNum)return new SquareBlock;if(1==blockNum)return new LineBlock;if(2==blockNum)return new StairBlock;if(3==blockNum)return new ZLeftBlock;if(4==blockNum)return new ZRightBlock;if(5==blockNum)return new GRightBlock;if(6==blockNum)return new GLeftBlock}function anim(){if(!LOSS){currentBlock.moveDown();setTimeout(anim,speed)}}function checkNextGridPlace(e,t){var n=defineGridIndex(e,t);if(0==grid[n])return true;return false}function defineGridIndex(e,t){var n=(e-canvasW/2+gridSizeX/2*blockSizeX)/blockSizeX%gridSizeX;var r=(t-startY)/blockSizeY;var i=r*gridSizeX+n;return r*gridSizeX+n}function clearFullLines(){var e=1;for(var t=gridSizeY-1;t>0;t--){var n=true;for(var r=1;r<gridSizeX+1;r++){if(true==grid[t][r].isEmpty)n=false}if(n){SCORE+=gridSizeX*e++;var i=t;while(i>0){for(var r=1;r<gridSizeX+1;r++){grid[i][r].isEmpty=grid[i-1][r].isEmpty;grid[i][r].color=grid[i-1][r].color}i--}t++;speed-=5}}drawGrid()}var canvasW=1200;var canvasH=700;var blockSizeX=24;var blockSizeY=24;var startY=150;var startX=canvasW/2;var gridSizeX=10;var gridSizeY=20;var speed=250;var dx=canvasW/2-gridSizeX/2*blockSizeX+blockSizeX;var dy=startY;var blockStartPos=gridSizeX/2;var borderX=canvasW/2-gridSizeX/2*blockSizeX;var borderY=startY;var DOWN=0;var LEFT=1;var RIGHT=2;var NUMBER_OF_BLOCKS=7;var SCORE=0;var LOSS=false;var backgroundColor="#222222";var borderColor="#777777";var borderThickness=2;var colors=["#33ffc5","#00ce0f","#c00fff"];GLeftBlock.prototype={draw:function(){for(var e=0;e<4;e++){ctx.fillStyle=color;ctx.fillRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY)}},clear:function(){for(var e=0;e<4;e++){ctx.clearRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY);ctx.fillStyle=backgroundColor;ctx.fillRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY)}},rotate:function(){currentRotateState++;if(4==currentRotateState)currentRotateState=0;this.clear();var e=new Array;for(var t=0;t<4;t++){e.push(new Point(points[t].raw+RStates[currentRotateState][t].raw,points[t].col+RStates[currentRotateState][t].col))}var n=0;for(var t=0;t<4;t++)if(true==grid[e[t].raw][e[t].col].isEmpty)n++;if(4==n){for(var t=0;t<4;t++){points[t].raw=e[t].raw;points[t].col=e[t].col}}else currentRotateState--;this.draw()},moveDown:function(){this.move(DOWN)},moveLeft:function(){this.move(LEFT)},moveRight:function(){this.move(RIGHT)},move:function(e){var t=false;this.clear();var n=new Array;if(DOWN==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw+1,points[r].col));if(LEFT==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw,points[r].col-1));if(RIGHT==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw,points[r].col+1));var i=0;for(var r=0;r<4;r++)if(true==grid[n[r].raw][n[r].col].isEmpty)i++;if(4==i)t=true;if(t){for(var r=0;r<4;r++){points[r].raw=n[r].raw;points[r].col=n[r].col}}else if(DOWN==e){for(var r=0;r<4;r++)n[r].raw--;for(var r=0;r<4;r++){grid[n[r].raw][n[r].col].isEmpty=false;grid[n[r].raw][n[r].col].color=color}clearFullLines();delete currentBlock;SCORE++;currentBlock=createNewBlock();drawGrid()}this.draw()}};GRightBlock.prototype={draw:function(){for(var e=0;e<4;e++){ctx.fillStyle=color;ctx.fillRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY)}},clear:function(){for(var e=0;e<4;e++){ctx.clearRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY);ctx.fillStyle=backgroundColor;ctx.fillRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY)}},rotate:function(){currentRotateState++;if(4==currentRotateState)currentRotateState=0;this.clear();var e=new Array;for(var t=0;t<4;t++){e.push(new Point(points[t].raw+RStates[currentRotateState][t].raw,points[t].col+RStates[currentRotateState][t].col))}var n=0;for(var t=0;t<4;t++)if(true==grid[e[t].raw][e[t].col].isEmpty)n++;if(4==n){for(var t=0;t<4;t++){points[t].raw=e[t].raw;points[t].col=e[t].col}}else currentRotateState--;this.draw()},moveDown:function(){this.move(DOWN)},moveLeft:function(){this.move(LEFT)},moveRight:function(){this.move(RIGHT)},move:function(e){var t=false;this.clear();var n=new Array;if(DOWN==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw+1,points[r].col));if(LEFT==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw,points[r].col-1));if(RIGHT==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw,points[r].col+1));var i=0;for(var r=0;r<4;r++)if(true==grid[n[r].raw][n[r].col].isEmpty)i++;if(4==i)t=true;if(t){for(var r=0;r<4;r++){points[r].raw=n[r].raw;points[r].col=n[r].col}}else if(DOWN==e){for(var r=0;r<4;r++)n[r].raw--;for(var r=0;r<4;r++){grid[n[r].raw][n[r].col].isEmpty=false;grid[n[r].raw][n[r].col].color=color}clearFullLines();delete currentBlock;SCORE++;currentBlock=createNewBlock();drawGrid()}this.draw()}};LineBlock.prototype={draw:function(){for(var e=0;e<4;e++){ctx.fillStyle=color;ctx.fillRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY)}},clear:function(){for(var e=0;e<4;e++){ctx.clearRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY);ctx.fillStyle=backgroundColor;ctx.fillRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY)}},rotate:function(){currentRotateState++;if(2==currentRotateState)currentRotateState=0;debugger;this.clear();var e=new Array;for(var t=0;t<4;t++){e.push(new Point(points[t].raw+RStates[currentRotateState][t].raw,points[t].col+RStates[currentRotateState][t].col))}var n=0;for(var t=0;t<4;t++)if(e[t].col<gridSizeX+2&&e[t].col<gridSizeY)n++;else n=-1;if(-1!=n){n=0;for(var t=0;t<4;t++)if(true==grid[e[t].raw][e[t].col].isEmpty)n++}if(4==n){for(var t=0;t<4;t++){points[t].raw=e[t].raw;points[t].col=e[t].col}}else currentRotateState--;this.draw()},moveDown:function(){this.move(DOWN)},moveLeft:function(){this.move(LEFT)},moveRight:function(){this.move(RIGHT)},move:function(e){var t=false;this.clear();var n=new Array;if(DOWN==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw+1,points[r].col));if(LEFT==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw,points[r].col-1));if(RIGHT==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw,points[r].col+1));var i=0;for(var r=0;r<4;r++)if(true==grid[n[r].raw][n[r].col].isEmpty)i++;if(4==i)t=true;if(t){for(var r=0;r<4;r++){points[r].raw=n[r].raw;points[r].col=n[r].col}}else if(DOWN==e){for(var r=0;r<4;r++)n[r].raw--;for(var r=0;r<4;r++){grid[n[r].raw][n[r].col].isEmpty=false;grid[n[r].raw][n[r].col].color=color}clearFullLines();delete currentBlock;currentBlock=createNewBlock();drawGrid()}this.draw()}};SquareBlock.prototype={draw:function(){for(var e=0;e<4;e++){ctx.fillStyle=color;ctx.fillRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY)}},clear:function(){for(var e=0;e<4;e++){ctx.clearRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY);ctx.fillStyle=backgroundColor;ctx.fillRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY)}},rotate:function(){},moveDown:function(){this.move(DOWN)},moveLeft:function(){this.move(LEFT)},moveRight:function(){this.move(RIGHT)},move:function(e){var t=false;this.clear();var n=new Array;if(DOWN==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw+1,points[r].col));if(LEFT==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw,points[r].col-1));if(RIGHT==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw,points[r].col+1));var i=0;for(var r=0;r<4;r++)if(true==grid[n[r].raw][n[r].col].isEmpty)i++;if(4==i)t=true;if(t){for(var r=0;r<4;r++){points[r].raw=n[r].raw;points[r].col=n[r].col}}else if(DOWN==e){for(var r=0;r<4;r++)n[r].raw--;for(var r=0;r<4;r++){grid[n[r].raw][n[r].col].isEmpty=false;grid[n[r].raw][n[r].col].color=color}clearFullLines();SCORE++;delete currentBlock;currentBlock=createNewBlock();drawGrid()}this.draw()}};StairBlock.prototype={draw:function(){for(var e=0;e<4;e++){ctx.fillStyle=color;ctx.fillRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY)}},clear:function(){for(var e=0;e<4;e++){ctx.clearRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY);ctx.fillStyle=backgroundColor;ctx.fillRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY)}},rotate:function(){currentRotateState++;if(4==currentRotateState)currentRotateState=0;this.clear();var e=new Array;for(var t=0;t<4;t++){e.push(new Point(points[t].raw+RStates[currentRotateState][t].raw,points[t].col+RStates[currentRotateState][t].col))}var n=0;for(var t=0;t<4;t++)if(true==grid[e[t].raw][e[t].col].isEmpty)n++;if(4==n){for(var t=0;t<4;t++){points[t].raw=e[t].raw;points[t].col=e[t].col}}else currentRotateState--;this.draw()},moveDown:function(){this.move(DOWN)},moveLeft:function(){this.move(LEFT)},moveRight:function(){this.move(RIGHT)},move:function(e){var t=false;this.clear();var n=new Array;if(DOWN==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw+1,points[r].col));if(LEFT==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw,points[r].col-1));if(RIGHT==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw,points[r].col+1));var i=0;for(var r=0;r<4;r++)if(true==grid[n[r].raw][n[r].col].isEmpty)i++;if(4==i)t=true;if(t){for(var r=0;r<4;r++){points[r].raw=n[r].raw;points[r].col=n[r].col}}else if(DOWN==e){for(var r=0;r<4;r++)n[r].raw--;for(var r=0;r<4;r++){grid[n[r].raw][n[r].col].isEmpty=false;grid[n[r].raw][n[r].col].color=color}clearFullLines();SCORE++;delete currentBlock;currentBlock=createNewBlock();drawGrid()}this.draw()}};ZRightBlock.prototype={draw:function(){for(var e=0;e<4;e++){ctx.fillStyle=color;ctx.fillRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY)}},clear:function(){for(var e=0;e<4;e++){ctx.clearRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY);ctx.fillStyle=backgroundColor;ctx.fillRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY)}},rotate:function(){currentRotateState++;if(4==currentRotateState)currentRotateState=0;this.clear();var e=new Array;for(var t=0;t<4;t++){e.push(new Point(points[t].raw+RStates[currentRotateState][t].raw,points[t].col+RStates[currentRotateState][t].col))}var n=0;for(var t=0;t<4;t++)if(true==grid[e[t].raw][e[t].col].isEmpty)n++;if(4==n){for(var t=0;t<4;t++){points[t].raw=e[t].raw;points[t].col=e[t].col}}else currentRotateState--;this.draw()},moveDown:function(){this.move(DOWN)},moveLeft:function(){this.move(LEFT)},moveRight:function(){this.move(RIGHT)},move:function(e){var t=false;this.clear();var n=new Array;if(DOWN==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw+1,points[r].col));if(LEFT==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw,points[r].col-1));if(RIGHT==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw,points[r].col+1));var i=0;for(var r=0;r<4;r++)if(true==grid[n[r].raw][n[r].col].isEmpty)i++;if(4==i)t=true;if(t){for(var r=0;r<4;r++){points[r].raw=n[r].raw;points[r].col=n[r].col}}else if(DOWN==e){for(var r=0;r<4;r++)n[r].raw--;for(var r=0;r<4;r++){grid[n[r].raw][n[r].col].isEmpty=false;grid[n[r].raw][n[r].col].color=color}clearFullLines();SCORE++;delete currentBlock;currentBlock=createNewBlock();drawGrid()}this.draw()}};ZLeftBlock.prototype={draw:function(){for(var e=0;e<4;e++){ctx.fillStyle=color;ctx.fillRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY)}},clear:function(){for(var e=0;e<4;e++){ctx.clearRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY);ctx.fillStyle=backgroundColor;ctx.fillRect(borderX+points[e].col*blockSizeX,borderY+points[e].raw*blockSizeY,blockSizeX,blockSizeY)}},rotate:function(){currentRotateState++;if(4==currentRotateState)currentRotateState=0;this.clear();var e=new Array;for(var t=0;t<4;t++){e.push(new Point(points[t].raw+RStates[currentRotateState][t].raw,points[t].col+RStates[currentRotateState][t].col))}var n=0;for(var t=0;t<4;t++)if(true==grid[e[t].raw][e[t].col].isEmpty)n++;if(4==n){for(var t=0;t<4;t++){points[t].raw=e[t].raw;points[t].col=e[t].col}}else currentRotateState--;this.draw()},moveDown:function(){this.move(DOWN)},moveLeft:function(){this.move(LEFT)},moveRight:function(){this.move(RIGHT)},move:function(e){var t=false;this.clear();var n=new Array;if(DOWN==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw+1,points[r].col));if(LEFT==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw,points[r].col-1));if(RIGHT==e)for(var r=0;r<4;r++)n.push(new Point(points[r].raw,points[r].col+1));var i=0;for(var r=0;r<4;r++)if(true==grid[n[r].raw][n[r].col].isEmpty)i++;if(4==i)t=true;if(t){for(var r=0;r<4;r++){points[r].raw=n[r].raw;points[r].col=n[r].col}}else if(DOWN==e){for(var r=0;r<4;r++)n[r].raw--;for(var r=0;r<4;r++){grid[n[r].raw][n[r].col].isEmpty=false;grid[n[r].raw][n[r].col].color=color}clearFullLines();SCORE++;delete currentBlock;currentBlock=createNewBlock();drawGrid()}this.draw()}};document.onkeydown=function(e){e=e||event;switch(e.keyCode){case 38:currentBlock.rotate();break;case 40:if(!LOSS)currentBlock.moveDown();break;case 37:if(!LOSS)currentBlock.moveLeft();break;case 39:if(!LOSS)currentBlock.moveRight();break}};var ex=document.getElementById("ex");var ctx=ex.getContext("2d");ex.width=canvasW;ex.height=canvasH;var blockNum=0;var grid;initGrid();drawBorder();drawGrid();var currentBlock=createNewBlock();anim()	</script>
	
</body>
</html>
